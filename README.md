# Flow ID Wireshark Plugin

This repository contains two complementary pieces for experimenting with flow
identifiers that originate from UDP metadata packets and need to be applied to
both UDP and TCP conversations in Wireshark:

* `wireshark/flow_id.lua` – a Lua post-dissector that discovers flow metadata
  and exposes it as a custom field (`flowid.id`). When the field is turned into
  a column, every packet that participates in the annotated sessions shows the
  matching flow identifier.
* `scripts/generate_sample_pcap.py` – a helper script that creates a PCAP file
  with UDP metadata packets and matching TCP conversations so the dissector can
  be tested without additional tooling.

## Wireshark plugin

1. Copy `wireshark/flow_id.lua` into your local Wireshark plugins directory
   (e.g. `~/.local/lib/wireshark/plugins/` on Linux or
   `%APPDATA%\Wireshark\plugins` on Windows).
2. Restart Wireshark. The dissector registers a new protocol named
   **Flow ID Tracker** with the custom field `flowid.id`.
3. Open a capture that contains the metadata packets. Right click a packet,
   choose **Protocol Preferences → Add Field as Column**, then select
   `Flow ID Tracker → Flow ID`. Wireshark will now display the identifier for
   every packet that belongs to the associated UDP or TCP sessions.
4. For convenience the plugin also appends the flow identifier to the *Info*
   column whenever a custom column is not configured.

The dissector expects metadata packets to contain ASCII payload similar to:

```
flow_id=<uuid>;tcp_port=<port>
```

Only `flow_id` is strictly required. When `tcp_port` is present, the plugin
propagates the identifier to the TCP stream that uses that port. Additional
key/value pairs are ignored.

## Sample capture generator

The generator is implemented with only Python's standard library, so no extra
dependencies are required. Create a sample capture file by running:

```
python scripts/generate_sample_pcap.py
```

A file named `sample_flows.pcap` will be written to the current working
directory. The script prints the UUID that was embedded in the metadata packet
so you can verify it inside Wireshark. Pass a different path as an argument to
store the capture elsewhere.

## Testing the plugin headlessly

`tshark` can be used to verify the plugin without the graphical interface. For
example:

```
tshark -r sample_flows.pcap -X lua_script:wireshark/flow_id.lua -T fields -e flowid.id | sort | uniq -c
```

The output should include the UUID generated by the script and an empty line
for packets that do not belong to a tagged flow.
